<!doctype html>
<html>
	<head>
		<title>Pie Chart</title>
		<script src="third-party/Chart.js"></script>
		<script src="third-party/jquery.js"></script>
		<script src="third-party/jquery-ui.js"></script>
		<script src="third-party/papaparse.js"></script>
		<link href="third-party/jquery-ui.css" rel="stylesheet">
	</head>
	<body>
		<input id="fileChooser" type="file" />
		<select id="selectmenu"></select>
	
		<div id="canvas-holder">
			<canvas id="chart-area" width="300" height="300"/>
		</div>


	<script>
	
	var stateData;
	var sliceAmount = 2;
	var colors = new Array( "#ACE600", "#FFCC33", "#FF6633", "#33CCFF", "#003DF5", "#CC33FF" );
	
	var pieData = [
    {
        value: 300,
        color:"#F7464A",
        highlight: "#FF5A5E",
        label: "Red"
    },
    {
        value: 50,
        color: "#46BFBD",
        highlight: "#5AD3D1",
        label: "Green"
    },
    {
        value: 100,
        color: "#FDB45C",
        highlight: "#FFC870",
        label: "Yellow"
    }
]
	
	var ctx = $("#chart-area").get(0).getContext("2d");
	var myPie = new Chart(ctx).Pie(pieData);
	
	$('#selectmenu').hide();
		

	$('#fileChooser').change(function() {
	Papa.parse(($('#fileChooser'))[0].files[0], {
		complete: function(results) {
			stateData = results.data;
			//console.log(stateData);
			$.each(stateData.slice(sliceAmount), function(index, value){
				//console.log(value[0]);
				$('#selectmenu').append("<option>"+value[0]+"</option>");
			});
			$( "#selectmenu" ).selectmenu();
			updateForIndex(sliceAmount, stateData);
			$("#selectmenu").selectmenu({change: function() {
				var index = (parseInt($("#selectmenu")[0].selectedIndex) + sliceAmount);
				console.log(index);
				updateForIndex(index, stateData);
			}
		});
		
		
				
		
		
		}
	});
	});

		function updateForIndex(index, stateData) {
			var newPieData = [];
				for ( var i = 2; i <= 7; i++ ) {
					var toPush = {
									color: colors[i-2],
									//highlight: colors[i-2],
									label : stateData[0][i],
									value : parseInt(stateData[index][i])
									};
					
					newPieData.push(toPush);
				}
				console.log(newPieData);
				
				//myPie.update();
				myPie.destroy();
				myPie = new Chart(ctx).Pie(newPieData);
				
				//for ( var j = 2; j <= 7; j++ ) {
				//	myPie.removeData(j);
				//}
				
				//for ( var k = 2; k <= 7; k++ ) {
				//	myPie.removeData(j);
				//}
				
				
				//myPie.addData(newPieData[0]);
				//pieData = newPieData;
				//myPie.update();
		}


	</script>
	</body>
</html>